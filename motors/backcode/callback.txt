Ven 11 Avril 2025 à 23h32
Pour le systm de confession (class ConfessionModal)


class ConfessionModal(discord.ui.Modal, title="Confession"):
    def __init__(self, confession_number):
        super().__init__()
        self.confession_number = confession_number

        # Champ pour saisir la confession
        self.confession_input = discord.ui.TextInput(
            label="Votre confession",
            style=discord.TextStyle.long,
            placeholder="Écrivez votre confession ici...",
            required=True
        )
        # Ajout du champ de texte à la vue
        self.add_item(self.confession_input)

    async def callback(self, interaction: discord.Interaction):
        try:
            # Différer la réponse pour éviter le délai de 3 secondes
            await interaction.response.defer(ephemeral=True)

            # Récupérer le texte de la confession
            confession_text = self.confession_input.value

            # Créer un embed pour la confession
            embed = discord.Embed(
                title=f"Confession #{self.confession_number}",
                description=f"```{confession_text}```",
                color=discord.Color.from_rgb(255, 255, 255)  # Couleur blanche
            )
            embed.set_image(url="https://media.discordapp.net/attachments/1328845912646356994/1360262128543596845/WhiteLine.png")  # Remplacez par l'URL de votre image

            # Récupérer le salon de confession depuis le fichier de configuration
            confession_channel_id = config.confession_channel
            confession_channel = interaction.guild.get_channel(confession_channel_id)

            # Vérifiez si le salon est valide
            if not confession_channel:
                raise ValueError("Le salon de confession configuré est introuvable ou invalide.")

            # Envoyer l'embed dans le salon de confession
            await confession_channel.send(embed=embed)

            # Répondre à l'utilisateur pour confirmer la soumission
            await interaction.followup.send(
                f"✅ Votre confession a été soumise anonymement sous le numéro **#{self.confession_number}**.",
                ephemeral=True
            )
        except Exception as e:
            # En cas d'erreur, envoyer un message d'erreur avec les détails
            await interaction.followup.send(
                f"❌ Une erreur s'est produite lors de l'envoi de la confession : {e}",
                ephemeral=True
            )
            # Afficher l'erreur dans la console pour le débogage
            print(f"Erreur dans ConfessionModal.callback : {e}")